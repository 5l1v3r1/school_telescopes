<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
    <title>Radio Astronomy Control Panel</title>
    <meta http-equiv="content-type" content="text/html;charset=utf-8" />
    <meta name="generator" content="Geany 1.24.1" />

   <script language="javascript" type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript">
        
    $(function() {
        function onHardwareData (hjson) {
            var goodkeys = {"Radiometer" : "etRadiometer", "Differential" : "etDifferential",
                "Interferometer" : "etInterferometer"}
            
            var goodrates = {1.0 : "srate1", 1.5 : "srate1_5", 2.0 : "srate2", 2.5 : "srate2_5",
                3.0 : "srate3", 4.0 : "srate4", 6.0 : "srate6", 8.0 : "srate8", 10.0 : "srate10"}
                
            key1 = hjson.myhw;
            $("#radioType").text("Installed Receiver(s): "+hjson.hwtypes[key1].hwname + " @" + window.location.origin);
            
            /*
             * Adjust available experiment types
             */
            for (key in hjson.hwtypes[key1]) {
                if (key in goodkeys) {
                    $("#"+goodkeys[key]).attr("disabled", false);
                }
            
            }
            
            /*
             * Get at the "system description" for this key
             */
            var sysdesc = hjson.hwtypes[key1];
            
            
            var freqs = sysdesc["freqs"];  // Frequency range
            var rfgains = sysdesc["rfgain"];  // RF gain range
            var rates = sysdesc["rates"];   // Sample rates

            /*
             * Adjust gain range control.
             */
            $("#rfgain").attr("min", rfgains[0]);
            $("#rfgain").attr("max", rfgains[1]);
            
            /*
             * Adjust available sample rates.
             */
            for (var i = 0; i < rates.length; i++) {
                if (rates[i] in goodrates) {
                    $("#"+goodrates[rates[i]]).attr("disabled", false);
                }
            }
            
          }

        $.ajax(
            {url: "experiments.json",
            type: "GET",
            dataType: "json",
            beforeSend: function(xhr){
            if (xhr.overrideMimeType)
            {
              xhr.overrideMimeType("application/json");
            }
          },
          success: onHardwareData
         });
    });
   </script>
</head>

<body bgcolor="lightgrey">
 <form action="/start.html" method="get">
     <h3>Start a New Experiment</h3>
     <h4 id="radioType">Installed radio(s): Unknown</h4>
<b>Sample Rate (Msps)</b>
  <input id="srate1" type="radio" name="srate" value="1.0" checked>1
  <input id="srate1_5" type="radio" name="srate" value="1.5" disabled="true">1.5
  <input id="srate2" type="radio" name="srate" value="2.0" disabled="true">2
  <input id="srate2_5" type="radio" name="srate" value="2.5" disabled="true">2.5
  <input id="srate3" type="radio" name="srate" value="3.0" disabled="true">3
  <input id="srate4" type="radio" name="srate" value="4.0" disabled="true">4
  <input id="srate6" type="radio" name="srate" value="6.0" disabled="true">6
  <input id="srate8" type="radio" name="srate" value="8.0" disabled="true">8
  <input id="srate10" type="radio" name="srate" value="10.0" disabled="true">10<br>
<b>Experiment Type</b><br>
  <input id="etRadiometer" type="radio" name="etype" value="radiometer" checked>Single Channel FFT Radiometer<br>
  <input id="etDifferential" type="radio" name="etype" value="differential" disabled="true">
  Dual Channel Differential FFT Radiometer<br>
  <input id="etInterferometer" type="radio" name="etype" value="interferometer" disabled="true">
  Dual Channel FX Interferometer<br>
  <b>Frequency</b> <input type="text" name="freq" required value="1420.4058e6">
  
  <b>RF Gain</b>
  <input style="width:300px" type="range" id="rfgain" name="rfgain" min=0 max=40 value="0" size=64 step=0.5
       oninput="amount.value=rfgain.value">    
  <output style="font-weight:bold" id="amount" name="amount" value="0"><b></b></output>                                                   
  <br>
  <b>Experiment Name</b><input type="text" name="expname" required maxlength=20><br>
  <b>Remote Logging Share</b> <input type="text" name="remote" maxlength=256 size=64><br>
  <b>Declination Target</b> <input type="number" name="declination" value=41 min=-90 max=90 step=0.5><br>
  <b>Experiment Notes</b><br>
  <textarea name="notes" style="width:350px;height:150px;"></textarea><br>
  <input type="submit" value="Start">
</form>
<hr>
<form action="/stop.html" method="get">
<h3>Stop Currently Running Experiment</h3>
<input type="submit" value="Stop">
</form> 
    
</body>

</html>
