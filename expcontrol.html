<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
    <title>Radio Astronomy Control Panel: {{host}}/{{ipaddr}}</title>
    <meta http-equiv="content-type" content="text/html;charset=utf-8" />
    <meta name="generator" content="Geany 1.24.1" />

   <script language="javascript" type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript">
    
    
    var hwtype = "Unknown"
    var host = "??"
    var ipaddr = "??"
    $(function() {
        function onHardwareData (hjson) {
			hwtype = hjson.hwtype;
			host = hjson.hostname;
			ipaddr = hjson.ipaddr;
			
			$.ajax(
            {url: "experiments.json",
            type: "GET",
            dataType: "json",
            beforeSend: function(xhr){
            if (xhr.overrideMimeType)
            {
              xhr.overrideMimeType("application/json");
            }
          },
          success: onExpData
         });
		}
		function onExpData (hjson) {
            var goodkeys = {"Combo-Radiometer" : "etRadiometer"}
            
            var goodrates = {1.0 : "srate1", 1.5 : "srate1_5", 2.0 : "srate2", 2.5 : "srate2_5",
                3.0 : "srate3", 4.0 : "srate4", 5.0 : "srate5", 6.0 : "srate6", 8.0 : "srate8", 10.0 : "srate10"}
                
            key1 = hwtype;
            $("#radioType").text("Installed Receiver(s): "+hjson.hwtypes[key1].hwname + " @" + ipaddr);
            
            /*
             * Adjust available experiment types
             */
            for (key in hjson.hwtypes[key1]) {
                if (key in goodkeys) {
                    $("#"+goodkeys[key]).attr("disabled", false);
                }
            
            }
            
            /*
             * Get at the "system description" for this key
             */
            var sysdesc = hjson.hwtypes[key1];
            
            
            var freqs = sysdesc["freqs"];  // Frequency range
            var rfgains = sysdesc["rfgains"];  // RF gain range
            var rates = sysdesc["rates"];   // Sample rates

            /*
             * Adjust gain range control.
             */
            $("#rfgain").attr("min", rfgains[0]);
            $("#rfgain").attr("max", rfgains[1]);
            
            /*
             * Adjust available sample rates.
             */
            for (var i = 0; i < rates.length; i++) {
                if (rates[i] in goodrates) {
                    $("#"+goodrates[rates[i]]).attr("disabled", false);
                }
            }
            
          }

        $.ajax(
            {url: "sysconfig.json",
            type: "GET",
            dataType: "json",
            beforeSend: function(xhr){
            if (xhr.overrideMimeType)
            {
              xhr.overrideMimeType("application/json");
            }
          },
          success: onHardwareData
         });
    });
   </script>
</head>

<body bgcolor="lightgrey">
 <form action="/start.html" method="get">
     <h3>Start a New Experiment</h3>
     <h4 id="radioType">Installed radio(s): Unknown</h4>
<hr>
<b>Sample Rate (Msps)</b>
  <input id="srate1" type="radio" name="srate" value="1.0" checked>1
  <input id="srate1_5" type="radio" name="srate" value="1.5" disabled="true">1.5
  <input id="srate2" type="radio" name="srate" value="2.0" disabled="true">2
  <input id="srate2_5" type="radio" name="srate" value="2.5" disabled="true">2.5
  <input id="srate3" type="radio" name="srate" value="3.0" disabled="true">3
  <input id="srate4" type="radio" name="srate" value="4.0" disabled="true">4
  <input id="srate5" type="radio" name="srate" value="5.0" disabled="true">5
  <input id="srate6" type="radio" name="srate" value="6.0" disabled="true">6
  <input id="srate8" type="radio" name="srate" value="8.0" disabled="true">8
  <input id="srate10" type="radio" name="srate" value="10.0" disabled="true">10<br>
<b>Experiment Type</b><br>
  <input id="etRadiometer" type="radio" name="etype" value="radiometer" checked>Combo Radiometer<br>
  <input id="etPulsar" type="radio" name="etype" value="pulsar" disabled="True">Pulsar Monitor<br>
  <b>Spectral logging</b><input type="checkbox" id="splogging" name="speclog"><br>
  <b>Frequency</b> <input type="text" name="freq" required value="1420.4058e6">
  
  <b>RF Gain</b>
  <input type="number" id="rfgain" name="rfgain" min=0 max=40 value="0" step=0.5>                                                 
  <br>
  <hr>
  <b>Experiment Name</b><input type="text" name="expname" required maxlength=20><br>
  <b>Remote Logging Share</b> <input type="text" name="rmount" maxlength=256 size=64><br>
  <b>Remote Logging Username</b> <input type="text" name="ruser", maxlength=16><br>
  <b>Remote Logging Password</b> <input type="password" name="rpassword" maxlength=32><br>
  <b>Declination Target</b> <input type="text" name="declination" value=41 min=-90 max=90 step=0.1><br>
  <b>Local Longitude</b><input type="text" name="longitude" value="-75.9" min=-180 max=180 step=0.1>
  <b>Local Latitude</b><input type="text" name="latitude" value="44.9" min=-90 max=90 step=0.25><br>
  <b>Integration time</b><input type="number" name="integration" value=1.0 min=1.0 max=100.0 step=1><b>seconds</b><br>
  <b>Save profile</b><input type="checkbox" id="save" name="save">
  <b>Save to system startup</b><input type="checkbox" id="startup" name="startup"><br>

  <b>Experiment Notes</b><br>
  <textarea name="notes" style="width:350px;height:150px;"></textarea><br>
  <input type="submit" value="Start">
</form>
<hr>
<hr>
<form action="/stop.html" method="get">
<h3>Stop Currently Running Experiment: {{ running }} ({{ pid }})</h3>
<input type="submit" value="Stop">
</form> 
<hr>
<hr>
<form action="/restart.html" method="get">
<h3>Restart saved experiment profile</h3>
<b>Experiment Name</b><input type="text" name="expname" maxlength=16><br>
<p>
<i>Available profiles: {{ plist }}</i>
</p>
<input type="submit" value="Restart">
</form>
</body>
<hr>
<hr>
<form action="/profiles.html" method="get">
<h3>Manage Profiles</h3>
<p>
	<i>Available profiles: {{ plist}}</i>
</p>
<p>
To <b>just</b> delete current system-startup profile, leave Experiment Name blank
and select <i>Delete system startup profile</i>
<p>
To delete named profile select <i>Delete profile</i>, and to add profile to
system startup, select <i>Add profile to startup</i>
</p>
</p>
<br>
<b>Experiment Name</b><input type="text" name="expname" maxlength=16><br>
<b>Delete profile</b><input type="checkbox" name="delete">
<b>Add profile to startup</b><input type="checkbox" name="add"><br>
<b>Delete system startup profile ({{ startup }})</b><input type="checkbox" name="startup"><br>
<p>
<input type="submit" value="Update">
</form>
</html>
